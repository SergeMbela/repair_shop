name: Deploy Static HTML/JS

on:
  push:
    branches:
      - 'master' # ou 'master', vÃ©rifiez le nom de votre branche principale

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v4

      - name: Verify Secrets Presence ðŸ•µï¸
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        run: |
          if [ -z "$SUPABASE_URL" ]; then echo "::error::SUPABASE_URL secret is missing!"; exit 1; fi
          if [ -z "$SUPABASE_KEY" ]; then echo "::error::SUPABASE_KEY secret is missing!"; exit 1; fi
          echo "Secrets are correctly loaded in the environment."

      # C'est ici que la magie opÃ¨re : on crÃ©e un fichier JS avec les secrets
      - name: Create Config File ðŸ”§
        run: |
          echo "window.CONFIG = {" > config.js
          echo "    SUPABASE_URL: '${{ secrets.SUPABASE_URL }}'," >> config.js
          echo "    SUPABASE_KEY: '${{ secrets.SUPABASE_KEY }}'" >> config.js
          echo "};" >> config.js
          # Force git to see config.js by removing it from .gitignore if it exists
          if [ -f .gitignore ]; then sed -i '/config.js/d' .gitignore; fi

      - name: Deploy to GitHub Pages ðŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: . # On dÃ©ploie le dossier racine car c'est du HTML pur